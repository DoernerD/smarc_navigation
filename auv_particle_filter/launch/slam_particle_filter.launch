<?xml version="1.0" ?>
<launch>
	<arg name="namespace" default="sam"/>
  <arg name="real_robot" default="true"/>

  <!-- Frames -->
  <arg name="map_frame" default="map"/>
  <arg name="odom_frame"  default="$(arg namespace)/odom"/>
  <arg name="base_frame"  default="$(arg namespace)/base_link_pf"/>
  <!-- <arg name="base_frame_pf"  default="$(arg namespace)/base_link_pf"/> -->
  <arg name="ds_base_frame"  default="ds_base_link"/>
  <arg name="ds_range"  default="3"/>
  <arg name="base_frame_2d" default="$(arg namespace)/base_link_2d" />

  <!-- Topics -->
  <arg name="odom_topic" default="/$(arg namespace)/dr/odom" />
  <arg name="perception_topic" default="/sam/perception/estimated_pose_dropped" if="$(arg real_robot)"/>
  <arg name="perception_topic" default="/sam/perception/estimated_pose" unless="$(arg real_robot)"/>
  <arg name="ds_init_topic" default="/target/initial_estimate" />

  
  <!-- Different map_2_odom tfs depending on if we're using real SAM or 
  a Stonefish bag. -->
  <!-- REAL -->
  <group if="$(arg real_robot)">
    <node name="map_2_odom" pkg="tf" type="static_transform_publisher" args="0 0 0 0 0 0 map $(arg namespace)/odom 100"/>
    <node name="drop_pose_estim" pkg="topic_tools" type="drop" args="/sam/perception/estimated_pose 9 10 $(arg perception_topic)"/>
  </group>

  <!-- SIM -->
  <group unless="$(arg real_robot)">
    <node name="map_2_odom" pkg="tf" type="static_transform_publisher" args="0 0 0 1.571 0 3.1416 map $(arg namespace)/odom 100"/>
  </group>


  <!-- PF args -->
  <arg name="particle_count"  default="100"/>
  <!-- Order [x, y, z, roll, pitch, yaw] -->
  <arg name="init_covariance" default="[1e-3, 1e-3, 1e-3, 1e-4, 1e-4, 1e-4, 1e-3, 1e-3, 1e-3, 1e-4, 1e-4, 1e-4]"/>
  <arg name="motion_covariance" default="[1e-6, 1e-6, 1e-6, 1e-5, 1e-5, 1e-5, 1e-6, 1e-6, 1e-6, 1e-5, 1e-5, 1e-5]"/>
  <!-- <arg name="motion_covariance" default="[1e-6, 1e-8, 1e-6, 1e-6, 1e-6, 1e-8, 1e-6, 1e-6, 1e-6, 1e-5, 1e-5, 1e-5]"/> -->
  <!-- <arg name="motion_covariance" default="[1e-6, 1e-5, 1e-6, 1e-6, 1e-6, 1e-5, 1e-6, 1e-6, 1e-6, 1e-5, 1e-5, 1e-5]"/> -->
  <!-- <arg name="motion_covariance" default="[1e-10, 1e-10, 1e-10, 1e-10, 1e-10, 1e-10, 1e-10, 1e-10, 1e-10, 1e-10, 1e-10, 1e-10]"/> -->
  <!-- <arg name="resampling_noise_covariance" default="[1e-3, 1e-3, 1e-3, 1e-4, 1e-4, 1e-4, 1e-3, 1e-3, 1e-3, 1e-4, 1e-4, 1e-4]"/> -->
  <arg name="resampling_noise_covariance" default="[1e-4, 1e-4, 1e-4, 1e-4, 1e-4, 1e-4, 1e-4, 1e-4, 1e-4, 1e-4, 1e-4, 1e-4]"/>
  <arg name="measurement_std"  default="2."/>

  <group ns="$(arg namespace)">
      <node type="slam_particle_filter.py" pkg="auv_particle_filter" name="slam_particle_filter" output="screen">
        <param name="particle_count" type= "int" value="$(arg particle_count)" />
        <param name="ds_range" value="$(arg ds_range)" />        

        <param name="init_covariance" value="$(arg init_covariance)" />
        <param name="resampling_noise_covariance" value="$(arg resampling_noise_covariance)" />
        <param name="measurement_std" value="$(arg measurement_std)" />
        <param name="motion_covariance" value="$(arg motion_covariance)" />

        <param name="odom_topic" value="$(arg odom_topic)"/>
        <param name="perception_topic" value="$(arg perception_topic)"/>
        <param name="odom_corrected_topic" value="/$(arg namespace)/pf/odom"/>
        <param name="ds_corrected_topic" value="/$(arg namespace)/dr/ds_odom"/>
        <param name="sam_map_topic" value="/$(arg namespace)/dr/sam_map"/>
        <param name="ds_map_topic" value="/$(arg namespace)/dr/ds_map"/>
        <param name="sam_particle_poses_topic" value="/$(arg namespace)/dr/sam_particle_poses"/>
        <param name="ds_particle_poses_topic" value="/$(arg namespace)/dr/ds_particle_poses"/>
        <param name="ds_init_estimate" value="$(arg ds_init_topic)"/>
        <param name="particle_weight_topic" value="/$(arg namespace)/dr/particle_weight"/>
        <param name="sam_particle_topic" value="/$(arg namespace)/dr/sam_particle"/>
	      
        <param name="map_frame" value="$(arg map_frame)" />
        <param name="odom_frame" value="$(arg odom_frame)" />
        <param name="base_frame" value="$(arg base_frame)" />
        <!-- <param name="base_frame_pf" value="$(arg base_frame_pf)" /> -->
        <param name="ds_base_frame" value="$(arg ds_base_frame)" />
        <param name="base_frame_2d" value="$(arg base_frame_2d)"/>
      </node>
  </group>
</launch>

